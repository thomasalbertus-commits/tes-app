<!-- HR Tabs -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm mb-6">
  <div class="flex overflow-x-auto border-b border-slate-200">
    <% ['attendance','salary','payroll','leave','shift','budget'].forEach(t => { %>
      <a href="/hr?tab=<%= t %>" class="px-4 py-3 text-sm font-bold whitespace-nowrap border-b-2 transition-colors <%= tab === t ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700' %>">
        <%= t === 'attendance' ? 'Absensi' : t === 'salary' ? 'Setting Gaji' : t === 'payroll' ? 'Payroll' : t === 'leave' ? 'Cuti' : t === 'shift' ? 'Shift' : 'Anggaran' %>
      </a>
    <% }) %>
  </div>
</div>

<% if (tab === 'attendance') { %>
<!-- Attendance -->
<div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm mb-6">
  <h3 class="font-bold text-slate-800 mb-4">Check-in Karyawan</h3>
  <form method="POST" action="/hr/checkin" class="flex flex-col sm:flex-row gap-3">
    <select name="user_id" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm flex-1">
      <option value="">-- Pilih Karyawan --</option>
      <% employees.forEach(e => { %><option value="<%= e.id %>"><%= e.name %> (<%= e.role %>)</option><% }) %>
    </select>
    <button type="submit" class="px-6 py-2.5 bg-green-600 text-white rounded-xl text-sm font-bold hover:bg-green-700">Check-in</button>
  </form>
</div>

<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="p-4 border-b border-slate-200"><h3 class="font-bold text-slate-800">Absensi Hari Ini (<%= today %>)</h3></div>
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Nama</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Check-in</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Check-out</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Jam Kerja</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Aksi</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% if (attendance.length === 0) { %>
          <tr><td colspan="5" class="px-4 py-8 text-center text-slate-500">Belum ada absensi hari ini</td></tr>
        <% } %>
        <% attendance.forEach(a => { %>
          <tr>
            <td class="px-4 py-3 text-sm font-semibold"><%= a.user_name %></td>
            <td class="px-4 py-3 text-center text-sm text-green-600 font-bold"><%= a.check_in || '-' %></td>
            <td class="px-4 py-3 text-center text-sm text-red-600 font-bold"><%= a.check_out || '-' %></td>
            <td class="px-4 py-3 text-center text-sm"><%= a.work_hours || '-' %> jam</td>
            <td class="px-4 py-3 text-center">
              <% if (!a.check_out) { %>
                <form method="POST" action="/hr/checkout/<%= a.id %>" class="inline">
                  <button class="px-3 py-1.5 bg-red-600 text-white rounded-lg text-xs font-bold hover:bg-red-700">Check-out</button>
                </form>
              <% } else { %>
                <span class="text-xs text-green-600 font-bold">Selesai</span>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<% } else if (tab === 'salary') { %>
<!-- Salary Settings -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="p-4 border-b border-slate-200"><h3 class="font-bold text-slate-800">Setting Gaji Karyawan</h3></div>
  <div class="divide-y divide-slate-100">
    <% employees.forEach(e => { 
      const setting = salarySettings.find(s => s.user_id === e.id); 
    %>
      <form method="POST" action="/hr/salary" class="flex flex-col sm:flex-row items-start sm:items-center gap-3 p-4">
        <input type="hidden" name="user_id" value="<%= e.id %>">
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-sm"><%= e.name %></p>
          <p class="text-xs text-slate-500 capitalize"><%= e.role %></p>
        </div>
        <div>
          <label class="text-xs text-slate-500">Gaji Pokok</label>
          <input type="number" name="base_salary" value="<%= setting ? setting.base_salary : 0 %>" class="w-32 px-3 py-2 border border-slate-300 rounded-lg text-sm">
        </div>
        <div>
          <label class="text-xs text-slate-500">Komisi (%)</label>
          <input type="number" name="commission_rate" value="<%= setting ? setting.commission_rate : 0 %>" step="0.1" class="w-24 px-3 py-2 border border-slate-300 rounded-lg text-sm">
        </div>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700">Simpan</button>
      </form>
    <% }) %>
  </div>
</div>

<% } else if (tab === 'payroll') { %>
<!-- Payroll -->
<div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm mb-6">
  <h3 class="font-bold text-slate-800 mb-4">Buat Payroll</h3>
  <form method="POST" action="/hr/payroll" class="space-y-3">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <div>
        <label class="block text-xs font-semibold mb-1">Karyawan</label>
        <select name="user_id" required class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm">
          <% employees.forEach(e => { %><option value="<%= e.id %>"><%= e.name %></option><% }) %>
        </select>
      </div>
      <div>
        <label class="block text-xs font-semibold mb-1">Bulan</label>
        <input type="month" name="month" value="<%= month %>" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm">
      </div>
      <div>
        <label class="block text-xs font-semibold mb-1">Gaji Pokok</label>
        <input type="number" name="base_salary" value="0" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm">
      </div>
      <div>
        <label class="block text-xs font-semibold mb-1">Komisi</label>
        <input type="number" name="commission" value="0" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm">
      </div>
    </div>
    <div class="grid grid-cols-3 gap-3">
      <div><label class="block text-xs font-semibold mb-1">Bonus</label><input type="number" name="bonus" value="0" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"></div>
      <div><label class="block text-xs font-semibold mb-1">Potongan</label><input type="number" name="deduction" value="0" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"></div>
      <div><label class="block text-xs font-semibold mb-1">Total Gaji</label><input type="number" name="total_salary" value="0" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"></div>
    </div>
    <button type="submit" class="px-4 py-2.5 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700">Buat Payroll</button>
  </form>
</div>

<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Nama</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Bulan</th>
          <th class="px-4 py-3 text-right text-xs font-bold text-slate-600 uppercase">Total</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Status</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Aksi</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% payrolls.forEach(p => { %>
          <tr>
            <td class="px-4 py-3 text-sm font-semibold"><%= p.user_name %></td>
            <td class="px-4 py-3 text-center text-sm"><%= p.month %></td>
            <td class="px-4 py-3 text-right text-sm font-bold"><%= formatCurrency(p.total_salary) %></td>
            <td class="px-4 py-3 text-center">
              <span class="px-2 py-1 rounded-full text-xs font-bold <%= p.status === 'paid' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700' %>"><%= p.status === 'paid' ? 'Dibayar' : 'Draft' %></span>
            </td>
            <td class="px-4 py-3 text-center">
              <% if (p.status !== 'paid') { %>
                <form method="POST" action="/hr/payroll/<%= p.id %>/pay" class="inline"><button class="px-3 py-1 bg-green-600 text-white rounded-lg text-xs font-bold">Bayar</button></form>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<% } else if (tab === 'leave') { %>
<!-- Leave -->
<div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm mb-6">
  <h3 class="font-bold text-slate-800 mb-4">Ajukan Cuti/Izin</h3>
  <form method="POST" action="/hr/leave" class="flex flex-col md:flex-row gap-3">
    <select name="user_id" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
      <% employees.forEach(e => { %><option value="<%= e.id %>"><%= e.name %></option><% }) %>
    </select>
    <select name="type" class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
      <option value="Cuti">Cuti</option><option value="Izin">Izin</option><option value="Sakit">Sakit</option>
    </select>
    <input type="date" name="start_date" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
    <input type="date" name="end_date" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
    <input type="text" name="reason" placeholder="Alasan" class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm flex-1">
    <button type="submit" class="px-4 py-2.5 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700">Ajukan</button>
  </form>
</div>

<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Nama</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Tipe</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Tanggal</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase hidden md:table-cell">Alasan</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Status</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Aksi</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% leaves.forEach(l => { %>
          <tr>
            <td class="px-4 py-3 text-sm font-semibold"><%= l.user_name %></td>
            <td class="px-4 py-3 text-sm"><%= l.type %></td>
            <td class="px-4 py-3 text-xs"><%= l.start_date %> s/d <%= l.end_date %></td>
            <td class="px-4 py-3 text-sm text-slate-500 hidden md:table-cell"><%= l.reason || '-' %></td>
            <td class="px-4 py-3 text-center">
              <span class="px-2 py-1 rounded-full text-xs font-bold <%= l.status === 'approved' ? 'bg-green-100 text-green-700' : l.status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700' %>"><%= l.status %></span>
            </td>
            <td class="px-4 py-3 text-center">
              <% if (l.status === 'pending') { %>
                <div class="flex justify-center gap-1">
                  <form method="POST" action="/hr/leave/<%= l.id %>/status" class="inline"><input type="hidden" name="status" value="approved"><button class="px-2 py-1 bg-green-600 text-white rounded text-xs">OK</button></form>
                  <form method="POST" action="/hr/leave/<%= l.id %>/status" class="inline"><input type="hidden" name="status" value="rejected"><button class="px-2 py-1 bg-red-600 text-white rounded text-xs">Tolak</button></form>
                </div>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<% } else if (tab === 'shift') { %>
<!-- Shifts -->
<div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm mb-6">
  <h3 class="font-bold text-slate-800 mb-4">Tambah Shift</h3>
  <form method="POST" action="/hr/shift" class="flex flex-col sm:flex-row gap-3">
    <input type="text" name="name" placeholder="Nama Shift" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm flex-1">
    <input type="time" name="start_time" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
    <input type="time" name="end_time" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
    <button type="submit" class="px-4 py-2.5 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700">Simpan</button>
  </form>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
  <% shifts.forEach(s => { %>
    <div class="bg-white rounded-2xl p-4 border border-slate-200 shadow-sm flex items-center justify-between">
      <div>
        <p class="font-bold text-slate-800"><%= s.name %></p>
        <p class="text-sm text-slate-500"><%= s.start_time %> - <%= s.end_time %></p>
      </div>
      <form method="POST" action="/hr/shift/<%= s.id %>/delete" onsubmit="return confirm('Hapus shift?')">
        <button class="p-2 text-red-600 hover:bg-red-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
      </form>
    </div>
  <% }) %>
</div>

<% } else if (tab === 'budget') { %>
<!-- Budget -->
<div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm mb-6">
  <h3 class="font-bold text-slate-800 mb-4">Tambah Anggaran Bulanan</h3>
  <form method="POST" action="/hr/budget" class="flex flex-col sm:flex-row gap-3">
    <input type="text" name="name" placeholder="Nama" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm flex-1">
    <input type="number" name="amount" placeholder="Jumlah" required class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
    <input type="text" name="category" placeholder="Kategori" class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
    <input type="date" name="due_date" class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
    <button type="submit" class="px-4 py-2.5 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700">Simpan</button>
  </form>
</div>

<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Nama</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase hidden md:table-cell">Kategori</th>
          <th class="px-4 py-3 text-right text-xs font-bold text-slate-600 uppercase">Jumlah</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase hidden md:table-cell">Jatuh Tempo</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Aksi</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% budgets.forEach(b => { %>
          <tr>
            <td class="px-4 py-3 text-sm font-semibold"><%= b.name %></td>
            <td class="px-4 py-3 text-sm hidden md:table-cell"><%= b.category || '-' %></td>
            <td class="px-4 py-3 text-sm font-bold text-right"><%= formatCurrency(b.amount) %></td>
            <td class="px-4 py-3 text-xs text-slate-500 hidden md:table-cell"><%= b.due_date || '-' %></td>
            <td class="px-4 py-3 text-center">
              <form method="POST" action="/hr/budget/<%= b.id %>/delete" onsubmit="return confirm('Hapus?')">
                <button class="p-2 text-red-600 hover:bg-red-50 rounded-lg"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
<% } %>
