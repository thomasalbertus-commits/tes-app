<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= typeof title !== 'undefined' ? title : 'Tracking Servis' %> - iFix Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
  <div class="max-w-2xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-full shadow-sm border border-slate-200 mb-4">
        <span class="text-2xl">üîß</span>
        <span class="font-extrabold text-slate-800">iFix Pro</span>
      </div>
      <h1 class="text-2xl font-extrabold text-slate-800 mb-1">Tracking Servis</h1>
      <p class="text-sm text-slate-500">Masukkan token servis untuk melihat status perbaikan</p>
    </div>

    <!-- Search -->
    <form method="GET" action="/tracking" class="mb-6">
      <div class="flex gap-2">
        <input type="text" name="token" value="<%= token %>" placeholder="Masukkan token (contoh: SRV-XXXX)" 
          class="flex-1 px-5 py-3.5 border border-slate-300 rounded-2xl text-sm font-semibold text-center tracking-widest uppercase shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
        <button type="submit" class="px-6 py-3.5 bg-blue-600 text-white rounded-2xl font-bold hover:bg-blue-700 shadow-sm">
          Cari
        </button>
      </div>
    </form>

    <% if (typeof error !== 'undefined' && error) { %>
      <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl text-sm text-center mb-6">
        <strong><%= error %></strong>
      </div>
    <% } %>

    <% if (service) { %>
      <!-- Status Progress -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm mb-4">
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-bold text-slate-800">Status Servis</h2>
          <span class="px-3 py-1 rounded-full text-xs font-bold 
            <%= service.status === 'antrian' ? 'bg-yellow-100 text-yellow-700' : 
               service.status === 'proses' ? 'bg-blue-100 text-blue-700' : 
               service.status === 'selesai' ? 'bg-green-100 text-green-700' : 
               service.status === 'diambil' ? 'bg-teal-100 text-teal-700' : 
               'bg-red-100 text-red-700' %>"><%= service.status?.toUpperCase() %></span>
        </div>
        
        <!-- Progress Bar -->
        <% 
          const steps = ['antrian', 'proses', 'selesai', 'diambil'];
          const currentIdx = steps.indexOf(service.status);
        %>
        <div class="flex items-center gap-1 mb-6">
          <% steps.forEach((step, i) => { %>
            <div class="flex-1 h-2 rounded-full <%= i <= currentIdx ? 'bg-blue-600' : 'bg-slate-200' %>"></div>
          <% }) %>
        </div>
        <div class="flex justify-between text-xs text-slate-500">
          <% steps.forEach((step, i) => { %>
            <span class="<%= i <= currentIdx ? 'text-blue-600 font-bold' : '' %>"><%= step.charAt(0).toUpperCase() + step.slice(1) %></span>
          <% }) %>
        </div>
      </div>

      <!-- Service Info -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm mb-4">
        <h3 class="font-bold text-slate-800 mb-3">Informasi Servis</h3>
        <div class="grid grid-cols-2 gap-3">
          <div class="bg-slate-50 rounded-xl p-3">
            <p class="text-xs text-slate-500">Token</p>
            <p class="font-bold text-blue-600 tracking-wider"><%= service.token %></p>
          </div>
          <div class="bg-slate-50 rounded-xl p-3">
            <p class="text-xs text-slate-500">Tanggal Masuk</p>
            <p class="font-semibold text-sm"><%= new Date(service.created_at).toLocaleDateString('id-ID', {day:'2-digit',month:'long',year:'numeric'}) %></p>
          </div>
          <div class="bg-slate-50 rounded-xl p-3">
            <p class="text-xs text-slate-500">Customer</p>
            <p class="font-semibold text-sm"><%= service.customer_name || '-' %></p>
          </div>
          <div class="bg-slate-50 rounded-xl p-3">
            <p class="text-xs text-slate-500">No. HP</p>
            <p class="font-semibold text-sm"><%= service.customer_phone || '-' %></p>
          </div>
        </div>
      </div>

      <!-- Unit Info -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm mb-4">
        <h3 class="font-bold text-slate-800 mb-3">Informasi Unit</h3>
        <div class="grid grid-cols-2 gap-3">
          <div class="bg-slate-50 rounded-xl p-3">
            <p class="text-xs text-slate-500">Brand</p>
            <p class="font-semibold text-sm"><%= service.brand || '-' %></p>
          </div>
          <div class="bg-slate-50 rounded-xl p-3">
            <p class="text-xs text-slate-500">Tipe</p>
            <p class="font-semibold text-sm"><%= service.unit_type || '-' %></p>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 col-span-2">
            <p class="text-xs text-slate-500">Kerusakan</p>
            <p class="font-semibold text-sm"><%= service.damage_description || '-' %></p>
          </div>
        </div>
      </div>

      <!-- Sparepart -->
      <% if (service.parts && service.parts.length > 0) { %>
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm mb-4">
        <h3 class="font-bold text-slate-800 mb-3">Sparepart Digunakan</h3>
        <div class="space-y-2">
          <% service.parts.forEach(p => { %>
            <div class="flex justify-between items-center bg-slate-50 rounded-xl p-3">
              <span class="text-sm font-semibold"><%= p.name %></span>
              <span class="text-sm text-slate-500">x<%= p.qty %></span>
            </div>
          <% }) %>
        </div>
      </div>
      <% } %>

      <!-- Financial -->
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm mb-4">
        <h3 class="font-bold text-slate-800 mb-3">Biaya</h3>
        <div class="space-y-2">
          <div class="flex justify-between text-sm"><span class="text-slate-500">Estimasi Biaya</span><span class="font-bold">Rp <%= (service.estimated_cost || 0).toLocaleString('id-ID') %></span></div>
          <% if (service.dp_amount > 0) { %>
            <div class="flex justify-between text-sm"><span class="text-slate-500">DP Dibayar</span><span class="font-bold text-green-600">Rp <%= (service.dp_amount || 0).toLocaleString('id-ID') %></span></div>
          <% } %>
          <% if (service.total_paid > 0) { %>
            <div class="flex justify-between text-sm"><span class="text-slate-500">Total Dibayar</span><span class="font-bold text-green-600">Rp <%= (service.total_paid || 0).toLocaleString('id-ID') %></span></div>
          <% } %>
          <% const sisa = (service.estimated_cost || 0) - (service.total_paid || 0); %>
          <% if (sisa > 0) { %>
            <div class="flex justify-between text-sm border-t pt-2"><span class="text-slate-500 font-semibold">Sisa Bayar</span><span class="font-bold text-red-600">Rp <%= sisa.toLocaleString('id-ID') %></span></div>
          <% } %>
        </div>
      </div>

      <!-- Store Info -->
      <% if (store) { %>
      <div class="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm">
        <h3 class="font-bold text-slate-800 mb-3">Informasi Toko</h3>
        <p class="font-semibold text-sm"><%= store.name %></p>
        <% if (store.address) { %><p class="text-xs text-slate-500"><%= store.address %></p><% } %>
        <% if (store.phone) { %><p class="text-xs text-slate-500 mt-1">üìû <%= store.phone %></p><% } %>
      </div>
      <% } %>

    <% } else if (!token) { %>
      <!-- Empty state -->
      <div class="text-center py-12">
        <div class="text-6xl mb-4">üîç</div>
        <p class="text-slate-500 text-sm">Masukkan token servis Anda di kolom di atas</p>
      </div>
    <% } %>

    <!-- Back Link -->
    <div class="text-center mt-8">
      <a href="/login" class="text-sm text-blue-600 hover:underline">‚Üê Kembali ke Login</a>
    </div>
  </div>
</body>
</html>
