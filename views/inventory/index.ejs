<!-- Tab Navigation -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm mb-6">
  <div class="flex overflow-x-auto border-b border-slate-200">
    <% ['items','adjustment','opname','alerts'].forEach(t => { %>
      <a href="/inventory?tab=<%= t %>" class="px-4 py-3 text-sm font-bold whitespace-nowrap border-b-2 transition-colors <%= tab === t ? 'border-blue-600 text-blue-600' : 'border-transparent text-slate-500 hover:text-slate-700' %>">
        <%= t === 'items' ? 'Semua Barang' : t === 'adjustment' ? 'Penyesuaian' : t === 'opname' ? 'Riwayat Opname' : 'Stok Rendah' %>
      </a>
    <% }) %>
  </div>
</div>

<!-- Summary Cards -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
  <div class="bg-white rounded-2xl p-4 border border-slate-200 shadow-sm">
    <p class="text-xs text-slate-500 font-semibold">Total Item</p>
    <p class="text-2xl font-extrabold text-slate-800"><%= items.length %></p>
  </div>
  <div class="bg-white rounded-2xl p-4 border border-slate-200 shadow-sm">
    <p class="text-xs text-slate-500 font-semibold">Stok Rendah</p>
    <p class="text-2xl font-extrabold text-red-600"><%= lowStock.length %></p>
  </div>
  <div class="bg-white rounded-2xl p-4 border border-slate-200 shadow-sm">
    <p class="text-xs text-slate-500 font-semibold">Nilai Stok (Beli)</p>
    <p class="text-lg font-extrabold text-orange-600"><%= formatCurrency(stockValue.buy) %></p>
  </div>
  <div class="bg-white rounded-2xl p-4 border border-slate-200 shadow-sm">
    <p class="text-xs text-slate-500 font-semibold">Nilai Stok (Jual)</p>
    <p class="text-lg font-extrabold text-green-600"><%= formatCurrency(stockValue.sell) %></p>
  </div>
</div>

<% if (tab === 'items') { %>
<!-- Search & Filter -->
<div class="bg-white rounded-2xl p-4 border border-slate-200 shadow-sm mb-6">
  <form method="GET" class="flex flex-col md:flex-row gap-2">
    <input type="hidden" name="tab" value="items">
    <input type="text" name="search" value="<%= search %>" placeholder="Cari nama barang..." class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm flex-1">
    <select name="category" class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
      <option value="">Semua Kategori</option>
      <% categories.forEach(c => { %><option value="<%= c.name %>" <%= category === c.name ? 'selected' : '' %>><%= c.name %></option><% }) %>
    </select>
    <select name="brand" class="px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
      <option value="">Semua Brand</option>
      <% brands.forEach(b => { %><option value="<%= b.name %>" <%= brand === b.name ? 'selected' : '' %>><%= b.name %></option><% }) %>
    </select>
    <button type="submit" class="px-4 py-2.5 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700"><i data-lucide="search" class="w-4 h-4 inline"></i> Cari</button>
    <a href="/inventory/new" class="px-4 py-2.5 bg-green-600 text-white rounded-xl text-sm font-bold hover:bg-green-700 text-center">+ Tambah</a>
  </form>
</div>

<!-- Items Table -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Nama</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase hidden md:table-cell">Kategori</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase hidden md:table-cell">Brand</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Stok</th>
          <th class="px-4 py-3 text-right text-xs font-bold text-slate-600 uppercase hidden md:table-cell">Beli</th>
          <th class="px-4 py-3 text-right text-xs font-bold text-slate-600 uppercase">Jual</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Aksi</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% if (items.length === 0) { %>
          <tr><td colspan="7" class="px-4 py-8 text-center text-slate-500">Belum ada barang</td></tr>
        <% } %>
        <% items.forEach(item => { %>
          <tr class="hover:bg-slate-50">
            <td class="px-4 py-3">
              <p class="font-semibold text-sm"><%= item.name %></p>
              <p class="text-xs text-slate-500"><%= item.sub_category || '' %></p>
            </td>
            <td class="px-4 py-3 text-sm text-slate-600 hidden md:table-cell"><%= item.category || '-' %></td>
            <td class="px-4 py-3 text-sm text-slate-600 hidden md:table-cell"><%= item.brand || '-' %></td>
            <td class="px-4 py-3 text-center">
              <span class="font-bold text-sm <%= item.stock <= item.min_stock ? 'text-red-600' : 'text-slate-800' %>"><%= item.stock %></span>
              <% if (item.stock <= item.min_stock) { %><span class="text-xs text-red-500 block">min: <%= item.min_stock %></span><% } %>
            </td>
            <td class="px-4 py-3 text-right text-sm hidden md:table-cell"><%= formatCurrency(item.buy_price) %></td>
            <td class="px-4 py-3 text-right text-sm font-semibold"><%= formatCurrency(item.sell_price) %></td>
            <td class="px-4 py-3 text-center">
              <div class="flex justify-center gap-1">
                <a href="/inventory/<%= item.id %>/edit" class="p-2 text-yellow-600 hover:bg-yellow-50 rounded-lg" title="Edit"><i data-lucide="pencil" class="w-4 h-4"></i></a>
                <form method="POST" action="/inventory/<%= item.id %>/delete" onsubmit="return confirm('Yakin hapus barang ini?')" class="inline">
                  <button class="p-2 text-red-600 hover:bg-red-50 rounded-lg" title="Hapus"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </form>
              </div>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<% } else if (tab === 'adjustment') { %>
<!-- Stock Adjustment -->
<div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
  <h3 class="font-bold text-slate-800 mb-4">Penyesuaian Stok</h3>
  <div class="space-y-4">
    <% items.forEach(item => { %>
      <form method="POST" action="/inventory/<%= item.id %>/adjust" class="flex flex-col sm:flex-row items-start sm:items-center gap-3 p-3 bg-slate-50 rounded-xl">
        <div class="flex-1">
          <p class="font-semibold text-sm"><%= item.name %></p>
          <p class="text-xs text-slate-500">Stok saat ini: <span class="font-bold"><%= item.stock %></span></p>
        </div>
        <input type="number" name="adjustment" placeholder="+/-" class="w-24 px-3 py-2 border border-slate-300 rounded-lg text-sm text-center" required>
        <input type="text" name="notes" placeholder="Keterangan" class="px-3 py-2 border border-slate-300 rounded-lg text-sm flex-1">
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700">Simpan</button>
      </form>
    <% }) %>
  </div>
</div>

<% } else if (tab === 'opname') { %>
<!-- Opname History -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Tanggal</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Item</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Lama</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Baru</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Selisih</th>
          <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Catatan</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% if (opnameHistory.length === 0) { %>
          <tr><td colspan="6" class="px-4 py-8 text-center text-slate-500">Belum ada riwayat opname</td></tr>
        <% } %>
        <% opnameHistory.forEach(h => { %>
          <tr>
            <td class="px-4 py-3 text-xs text-slate-500"><%= formatDate(h.created_at) %></td>
            <td class="px-4 py-3 text-sm font-semibold"><%= h.item_name %></td>
            <td class="px-4 py-3 text-center text-sm"><%= h.old_stock %></td>
            <td class="px-4 py-3 text-center text-sm font-bold"><%= h.new_stock %></td>
            <td class="px-4 py-3 text-center text-sm font-bold <%= h.difference > 0 ? 'text-green-600' : 'text-red-600' %>"><%= h.difference > 0 ? '+' : '' %><%= h.difference %></td>
            <td class="px-4 py-3 text-xs text-slate-500"><%= h.notes || '-' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<% } else if (tab === 'alerts') { %>
<!-- Low Stock Alerts -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-red-50 border-b border-red-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-bold text-red-600 uppercase">Nama</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-red-600 uppercase">Stok</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-red-600 uppercase">Min. Stok</th>
          <th class="px-4 py-3 text-center text-xs font-bold text-red-600 uppercase">Kurang</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% if (lowStock.length === 0) { %>
          <tr><td colspan="4" class="px-4 py-8 text-center text-green-600 font-semibold">Semua stok aman! üëç</td></tr>
        <% } %>
        <% lowStock.forEach(item => { %>
          <tr class="bg-red-50/50">
            <td class="px-4 py-3 text-sm font-semibold"><%= item.name %></td>
            <td class="px-4 py-3 text-center text-red-600 font-bold"><%= item.stock %></td>
            <td class="px-4 py-3 text-center text-sm"><%= item.min_stock %></td>
            <td class="px-4 py-3 text-center font-bold text-red-700"><%= item.min_stock - item.stock %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
<% } %>
