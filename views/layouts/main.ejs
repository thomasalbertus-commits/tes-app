<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title><%= typeof title !== 'undefined' ? title + ' - ' : '' %>iFix Pro Enterprise</title>
  <meta name="description" content="Aplikasi POS untuk Service HP & Penjualan - iFix Pro Enterprise">
  <meta name="theme-color" content="#1e40af">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232563eb;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%231d4ed8;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23grad)' rx='20'/%3E%3Ctext x='50' y='70' font-family='Arial' font-size='50' font-weight='bold' fill='white' text-anchor='middle'%3EiF%3C/text%3E%3C/svg%3E">
  
  <style>
    body { background-color: #f8fafc; font-family: 'Inter', sans-serif; overflow-x: hidden; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    .saas-gradient { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
    
    .sidebar-scroll::-webkit-scrollbar { width: 4px; }
    .sidebar-scroll::-webkit-scrollbar-track { background: #0f172a; }
    .sidebar-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    
    @keyframes scaleUp { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    .animate-scale-up { animation: scaleUp 0.3s ease-out forwards; }
    
    @media print {
      .no-print { display: none !important; }
      body { background: white; }
    }
    
    /* Bottom Nav */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 40;
      background: white; border-top: 1px solid #e2e8f0;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
      padding: 4px 8px; padding-bottom: max(4px, env(safe-area-inset-bottom));
      display: none;
    }
    @media (max-width: 767px) {
      .bottom-nav { display: flex; justify-content: space-around; align-items: center; }
      .mobile-bottom-padding { padding-bottom: 80px !important; }
      input, select, textarea { font-size: 16px !important; min-height: 44px; }
    }
    .bottom-nav-item {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 6px 4px; border-radius: 8px; transition: all 0.2s;
      min-width: 56px; cursor: pointer; border: none; background: transparent;
      color: #64748b; font-size: 9px; font-weight: 600; text-decoration: none;
    }
    .bottom-nav-item.active { color: #2563eb; background: #eff6ff; }
    .bottom-nav-item i { width: 20px; height: 20px; margin-bottom: 2px; }
    
    /* Toast */
    .toast { position: fixed; top: 20px; right: 20px; z-index: 9999; animation: fadeIn 0.3s; }
    
    /* Modal backdrop */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; display: flex; align-items: center; justify-content: center; }
    .modal-content { background: white; border-radius: 16px; max-width: 600px; width: 95%; max-height: 90vh; overflow-y: auto; animation: scaleUp 0.3s; }
  </style>
</head>
<body class="bg-slate-50">
  <% if (typeof currentUser !== 'undefined' && currentUser) { %>
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <%- include('../partials/sidebar') %>
      
      <!-- Main Content -->
      <div class="flex-1 md:ml-64">
        <!-- Top Header -->
        <%- include('../partials/header') %>
        
        <!-- Page Content -->
        <main class="p-4 md:p-6 mobile-bottom-padding">
          <!-- Flash Messages -->
          <%- include('../partials/flash') %>
          
          <%- body %>
        </main>
      </div>
      
      <!-- Bottom Nav (Mobile) -->
      <%- include('../partials/bottom-nav') %>
    </div>
    
    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"></div>
  <% } else { %>
    <%- body %>
  <% } %>
  
  <!-- App JS -->
  <script src="/js/app.js"></script>
  <script>
    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') lucide.createIcons();
  </script>
</body>
</html>
