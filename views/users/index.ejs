<!-- Employee Management -->
<div class="flex justify-between items-center mb-6">
  <p class="text-sm text-slate-500"><%= employees.length %> pegawai</p>
  <button onclick="document.getElementById('addModal').classList.remove('hidden')" class="px-4 py-2.5 bg-green-600 text-white rounded-xl text-sm font-bold hover:bg-green-700 flex items-center gap-2">
    <i data-lucide="plus" class="w-4 h-4"></i> Tambah Pegawai
  </button>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  <% employees.forEach(e => { %>
    <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
      <div class="flex items-start justify-between mb-3">
        <div>
          <h3 class="font-bold text-slate-800"><%= e.name %></h3>
          <p class="text-xs text-slate-500"><%= e.email %></p>
        </div>
        <span class="px-2 py-1 rounded-full text-xs font-bold capitalize <%= e.is_active ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700' %>"><%= e.is_active ? 'Aktif' : 'Nonaktif' %></span>
      </div>
      <div class="space-y-1 text-sm mb-3">
        <p><span class="text-slate-500">Role:</span> <span class="font-semibold capitalize"><%= e.role %></span></p>
        <p><span class="text-slate-500">Bergabung:</span> <span class="font-semibold"><%= formatDateOnly(e.created_at) %></span></p>
      </div>
      <div class="flex gap-2">
        <button onclick='editEmployee(<%- JSON.stringify(e) %>)' class="px-3 py-1.5 bg-yellow-500 text-white rounded-lg text-xs font-bold hover:bg-yellow-600">Edit</button>
        <form method="POST" action="/employees/<%= e.id %>/delete" onsubmit="return confirm('Yakin hapus pegawai ini?')" class="inline">
          <button class="px-3 py-1.5 bg-red-600 text-white rounded-lg text-xs font-bold hover:bg-red-700">Hapus</button>
        </form>
      </div>
    </div>
  <% }) %>
</div>

<!-- Add Modal -->
<div id="addModal" class="modal-backdrop hidden">
  <div class="modal-content p-6">
    <div class="flex justify-between items-center mb-4">
      <h3 class="font-bold text-lg">Tambah Pegawai</h3>
      <button onclick="document.getElementById('addModal').classList.add('hidden')" class="p-2 hover:bg-slate-100 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button>
    </div>
    <form method="POST" action="/employees">
      <div class="space-y-3">
        <div><label class="block text-sm font-semibold mb-1">Nama *</label><input type="text" name="name" required class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm"></div>
        <div><label class="block text-sm font-semibold mb-1">Email *</label><input type="email" name="email" required class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm"></div>
        <div><label class="block text-sm font-semibold mb-1">Password *</label><input type="password" name="password" required class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm"></div>
        <div><label class="block text-sm font-semibold mb-1">Role</label>
          <select name="role" class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
            <option value="teknisi">Teknisi</option>
            <option value="kasir">Kasir</option>
            <option value="admin">Admin</option>
            <option value="owner">Owner</option>
          </select>
        </div>
        <div><label class="block text-sm font-semibold mb-1">Toko</label>
          <select name="store_id" class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
            <% stores.forEach(s => { %><option value="<%= s.id %>"><%= s.name %></option><% }) %>
          </select>
        </div>
      </div>
      <div class="mt-4 flex gap-3">
        <button type="submit" class="px-6 py-2.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700">Simpan</button>
        <button type="button" onclick="document.getElementById('addModal').classList.add('hidden')" class="px-6 py-2.5 bg-slate-200 text-slate-700 rounded-xl font-bold">Batal</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal-backdrop hidden">
  <div class="modal-content p-6">
    <div class="flex justify-between items-center mb-4">
      <h3 class="font-bold text-lg">Edit Pegawai</h3>
      <button onclick="document.getElementById('editModal').classList.add('hidden')" class="p-2 hover:bg-slate-100 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button>
    </div>
    <form method="POST" id="editForm">
      <div class="space-y-3">
        <div><label class="block text-sm font-semibold mb-1">Nama *</label><input type="text" name="name" id="editName" required class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm"></div>
        <div><label class="block text-sm font-semibold mb-1">Password Baru</label><input type="password" name="password" class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm" placeholder="Kosongkan jika tidak ubah"></div>
        <div><label class="block text-sm font-semibold mb-1">Role</label>
          <select name="role" id="editRole" class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
            <option value="teknisi">Teknisi</option><option value="kasir">Kasir</option>
            <option value="admin">Admin</option><option value="owner">Owner</option>
          </select>
        </div>
        <div><label class="block text-sm font-semibold mb-1">Toko</label>
          <select name="store_id" id="editStore" class="w-full px-4 py-2.5 border border-slate-300 rounded-xl text-sm">
            <% stores.forEach(s => { %><option value="<%= s.id %>"><%= s.name %></option><% }) %>
          </select>
        </div>
        <div>
          <label class="flex items-center gap-2 text-sm cursor-pointer">
            <input type="checkbox" name="is_active" id="editActive" value="1" class="rounded">
            <span>Aktif</span>
          </label>
        </div>
      </div>
      <div class="mt-4 flex gap-3">
        <button type="submit" class="px-6 py-2.5 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700">Perbarui</button>
        <button type="button" onclick="document.getElementById('editModal').classList.add('hidden')" class="px-6 py-2.5 bg-slate-200 text-slate-700 rounded-xl font-bold">Batal</button>
      </div>
    </form>
  </div>
</div>

<script>
function editEmployee(e) {
  document.getElementById('editForm').action = '/employees/' + e.id;
  document.getElementById('editName').value = e.name;
  document.getElementById('editRole').value = e.role;
  if (e.store_id) document.getElementById('editStore').value = e.store_id;
  document.getElementById('editActive').checked = !!e.is_active;
  document.getElementById('editModal').classList.remove('hidden');
}
</script>
